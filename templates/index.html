<!DOCTYPE html>
<html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/styles.css') }}">
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/filters.css') }}">
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/spectra.css') }}">
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/selection.css') }}">
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/modal.css') }}">
      
        <script src="{{ url_for('static', filename='scripts/filterSelection.js') }}"></script>
        <script src="{{ url_for('static', filename='scripts/inputValidation.js') }}"></script>
        <script src="{{ url_for('static', filename='scripts/generateSpectra.js') }}"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <title>AIMSES</title>
    </head>
    <body>

        <!-- Website Title -->
        <div class ="title">
            <h1>AIMSES</h1>
            <p>Auroral Ionosopheric Magnetospheric Statistical Electron Spectra</p>
        </div>


        <!-- Choose Filters -->
        <p style="margin-left: -650px; margin-bottom: -20px; margin-top: 30px; font-weight: 900;">STEP 1: Select Filtering Criteria</p>
        <div class = "selectionFrame"> 
            <div class = "selectionCategory" id="location">
                <h3>Location</h3>
                <div class="selectionCategoryContainer">
                    <button class="selectionButton" onclick="toggleVisibility('filter_mlt')">MLT</button>
                    <button class="selectionButton" onclick="toggleVisibility('filter_ilat')">ILAT</button>
                    <button class="selectionButton" onclick="toggleVisibility('filter_alt')">ALT</button>
                </div>
            </div>
            <div class = "selectionCategory" id="ionosphericConditions">
                <h3>Ionospheric Conditions</h3>
                <div class="selectionCategoryContainer">
                    <button class="selectionButton" onclick="toggleVisibility('filter_sza')">SZA</button>
                    <button class="selectionButton" onclick="toggleVisibility('filter_f107')">F10.7</button>
                </div>
            </div>
            <div class = "selectionCategory" id="magnetosphericConditions">
                <h3>Magnetospheric Conditions</h3>
                <div class="selectionCategoryContainer">
                    <button class="selectionButton" onclick="toggleVisibility('filter_eflux')">EFLUX</button>
                    <button class="selectionButton" onclick="toggleVisibility('filter_nflux')">NFLUX</button>
                    <button class="selectionButton" onclick="toggleVisibility('filter_conjugate_sza')">CONJUGATE SZA</button>
                    <button class="selectionButton" onclick="toggleVisibility('filter_kp')">KP</button>
                    <button class="selectionButton" onclick="toggleVisibility('filter_ae')">AE</button>
                    <button class="selectionButton" onclick="toggleVisibility('filter_dst')">DST</button>
                    <button class="selectionButton" onclick="toggleVisibility('filter_newell_flux')">SW DRIVING</button>
                    <button class="selectionButton" onclick="toggleVisibility('filter_lca')">LCA</button>
                    <button class="selectionButton" onclick="toggleVisibility('filter_mechs')">MECHANISMS</button>  
                </div>
            </div>
        </div>


        <!-- Select Values for Chosen Filters -->
        <p style="margin-left: -580px; margin-bottom: -20px; margin-top: 60px; font-weight: 900;">STEP 2: Select Values for Selected Filters</p>
        <div class ="filterFrame">
                
            <!-- MLT Filter  -->
            <div class="filterContainer" id="filter_mlt">
                <div class="filterTitle">MLT</div>
                <div class="filterDescription">Magnetic Global Time</div>
                <div class="filterGrid">
                    <div> 
                        <label id="rangeLabel" for="rangeSelect" style="display:block;">Range:</label>
                        <select id="rangeSelect" onchange="toggleFields('filter_mlt')">
                            <option value="" disabled selected>Select a Range</option>
                            <option value="between">Between</option>
                            <option value="lesserThan">Lesser Than</option>
                            <option value="greaterThan">Greater Than</option>
                        </select>
                    </div>
                    <div>
                        <label id="minRangeLabel" for="minRange" style="margin-left: 10px;">From</label>
                        <div class="inputContainer">
                            <input type="text" id="minRange" name="minRange" class="between" placeholder="Insert Value" style="display: none;"></input>
                            <span id="minRangeUnit" style="display: none;">HH:MM:SS</span>
                        </div>
                    </div>
                    <div>
                        <label id="maxRangeLabel" for="maxRange" style="margin-left: 10px;">To</label>
                        <div class="inputContainer">
                            <input type="text" id="maxRange" name="maxRange" class="between" placeholder="Insert Value" style="display: none;">
                            <span id="maxRangeUnit" style="display: none;">HH:MM:SS</span>
                        </div>
                    </div>
                    <div>
                        <label id="lesserThanLabel" for="lesserThanValue" style="margin-left: 10px;">Lesser Than</label>
                        <div class="inputContainer">
                            <input type="text" id="lesserThanValue" name="lesserThanValue" class="lesserThanInput" placeholder="Insert Value" style="display: none;">
                            <span id="lesserThanUnit" style="display: none;">HH:MM:SS</span>
                        </div>
                    </div>
                    <div>
                        <label id="greaterThanLabel" for="greaterThanValue" style="margin-left: 10px;">Greater Than</label>
                        <div class="inputContainer">
                            <input type="text" id="greaterThanValue" name="greaterThanValue" class="greaterThanInput" placeholder="Insert Value" style="display: none;">
                            <span id="greaterThanUnit" style="display: none;">HH:MM:SS</span>
                        </div>
                    </div>
                </div>
                <div id="error_message_range" class="error_message" style="display: none;"></div>
            </div>

            <!-- ILAT Filter  -->
            <div class="filterContainer" id="filter_ilat">
                <div class="filterTitle">ILAT</div>
                <div class="filterDescription"> Invariant Latitude</div>
                <div class="filterGrid">
                    <div> 
                        <label id="rangeLabel" for="rangeSelect" style="display:block;">Range:</label>
                        <select id="rangeSelect" onchange="toggleFields('filter_ilat')">
                            <option value="" disabled selected>Select a Range</option>
                            <option value="between">Between</option>
                            <option value="lesserThan">Lesser Than</option>
                            <option value="greaterThan">Greater Than</option>
                        </select>
                    </div>
                    <div>
                        <label id="minRangeLabel" for="minRange" style="margin-left: 10px;">From</label>
                        <div class="inputContainer">
                            <input type="text" id="minRange" name="minRange" class="between" placeholder="Insert Value" style="display: none;"></input>
                            <span id="minRangeUnit" style="display: none;">Degree(s)</span>
                        </div>
                    </div>
                    <div>
                        <label id="maxRangeLabel" for="maxRange" style="margin-left: 10px;">To</label>
                        <div class="inputContainer">
                            <input type="text" id="maxRange" name="maxRange" class="between" placeholder="Insert Value" style="display: none;">
                            <span id="maxRangeUnit" style="display: none;">Degree(s)</span>
                        </div>
                    </div>
                    <div>
                        <label id="lesserThanLabel" for="lesserThanValue" style="margin-left: 10px;">Lesser Than</label>
                        <div class="inputContainer">
                            <input type="text" id="lesserThanValue" name="lesserThanValue" class="lesserThanInput" placeholder="Insert Value" style="display: none;">
                            <span id="lesserThanUnit" style="display: none;">Degree(s)</span>
                        </div>
                    </div>
                    <div>
                        <label id="greaterThanLabel" for="greaterThanValue" style="margin-left: 10px;">Greater Than</label>
                        <div class="inputContainer">
                            <input type="text" id="greaterThanValue" name="greaterThanValue" class="greaterThanInput" placeholder="Insert Value" style="display: none;">
                            <span id="greaterThanUnit" style="display: none;">Degree(s)</span>
                        </div>
                    </div>
                </div>
                <div id="error_message_range" class="error_message" style="display: none;"></div>
                <div> 
                    <label id="hemisphereLabel" for="hemisphereSelect" style="display:block;">Hemisphere</label>
                    <select id="hemisphereSelect" onchange="checkSelect('hemisphereSelect')">
                        <option value="" disabled selected>Select a Hemisphere</option>
                        <option value="northernhemisphere">Northern Hemisphere</option>
                        <option value="southernhemisphere">Southern Hemisphere</option>
                        <option value="either">Either</option>
                    </select>
                </div>
                <div id="error_message_hemisphere" class="error_message" style="display: none;"></div>
            </div>

            <!-- ALT Filter  -->
            <div class="filterContainer" id="filter_alt">
                <div class="filterTitle">ALT</div>
                <div class="filterDescription">Altitude</div>
                <div class="filterGrid">
                    <div> 
                        <label id="rangeLabel" for="rangeSelect" style="display:block;">Range</label>
                        <select id="rangeSelect" onchange="toggleFields('filter_alt')">
                            <option value="" disabled selected>Select a Range</option>
                            <option value="between">Between</option>
                            <option value="lesserThan">Lesser Than</option>
                            <option value="greaterThan">Greater Than</option>
                        </select>
                    </div>
                    <div>
                        <label id="minRangeLabel" for="minRange" style="margin-left: 10px;">From</label>
                        <div class="inputContainer">
                            <input type="text" id="minRange" name="minRange" class="between" placeholder="Insert Value" style="display: none;"></input>
                            <span id="minRangeUnit" style="display: none; ">km</span>
                        </div>
                    </div>
                    <div>
                        <label id="maxRangeLabel" for="maxRange" style="margin-left: 10px;">To</label>
                        <div class="inputContainer">
                            <input type="text" id="maxRange" name="maxRange" class="between" placeholder="Insert Value" style="display: none;">
                            <span id="maxRangeUnit" style="display: none;">km</span>
                        </div>
                    </div>
                    <div>
                        <label id="lesserThanLabel" for="lesserThanValue" style="margin-left: 10px;">Lesser Than</label>
                        <div class="inputContainer">
                            <input type="text" id="lesserThanValue" name="lesserThanValue" class="lesserThanInput" placeholder="Insert Value" style="display: none;">
                            <span id="lesserThanUnit" style="display: none;">km</span>
                        </div>
                    </div>
                    <div>
                        <label id="greaterThanLabel" for="greaterThanValue" style="margin-left: 10px;">Greater Than</label>
                        <div class="inputContainer">
                            <input type="text" id="greaterThanValue" name="greaterThanValue" class="greaterThanInput" placeholder="Insert Value" style="display: none;">
                            <span id="greaterThanUnit" style="display: none;">km</span>
                        </div>
                    </div>
                </div>
                <div id="error_message_range" class="error_message" style="display: none;"></div>
            </div>
            
            <!-- SZA Filter  -->
            <div class="filterContainer" id="filter_sza">
                <div class="filterTitle">SZA</div>
                <div class="filterDescription">Solar Zenith Angle</div>
                <div class="filterGrid">
                    <div> 
                        <label id="rangeLabel" for="rangeSelect" style="display:block;">Range</label>
                        <select id="rangeSelect" onchange="toggleFields('filter_sza')">
                            <option value="" disabled selected>Select a Range</option>
                            <option value="between">Between</option>
                            <option value="lesserThan">Lesser Than</option>
                            <option value="greaterThan">Greater Than</option>
                        </select>
                    </div>
                    <div>
                        <label id="minRangeLabel" for="minRange" style="margin-left: 10px;">From</label>
                        <div class="inputContainer">
                            <input type="text" id="minRange" name="minRange" class="between" placeholder="Insert Value" style="display: none;"></input>
                            <span id="minRangeUnit" style="display: none;">Degree(s)</span>
                        </div>
                    </div>
                    <div>
                        <label id="maxRangeLabel" for="maxRange" style="margin-left: 10px;">To</label>
                        <div class="inputContainer">
                            <input type="text" id="maxRange" name="maxRange" class="between" placeholder="Insert Value" style="display: none;">
                            <span id="maxRangeUnit" style="display: none;">Degree(s)</span>
                        </div>
                    </div>
                    <div>
                        <label id="lesserThanLabel" for="lesserThanValue" style="margin-left: 10px;">Lesser Than</label>
                        <div class="inputContainer">
                            <input type="text" id="lesserThanValue" name="lesserThanValue" class="lesserThanInput" placeholder="Insert Value" style="display: none;">
                            <span id="lesserThanUnit" style="display: none;">Degree(s)</span>
                        </div>
                    </div>
                    <div>
                        <label id="greaterThanLabel" for="greaterThanValue" style="margin-left: 10px;">Greater Than</label>
                        <div class="inputContainer">
                            <input type="text" id="greaterThanValue" name="greaterThanValue" class="greaterThanInput" placeholder="Insert Value" style="display: none;">
                            <span id="greaterThanUnit" style="display: none;">Degree(s)</span>
                        </div>
                    </div>
                </div>
                <div id="error_message_range" class="error_message" style="display: none;"></div>
            </div>

            <!-- F10.7 Filter -->
            <div class="filterContainer" id="filter_f107">
                <div class="filterTitle">F10.7</div>
                <div class="filterDescription">F10.7 CM Radio Flux/Emissions</div>
                <div class="filterGrid">
                    <div> 
                        <label id="rangeLabel" for="rangeSelect" style="display:block;">Range</label>
                        <select id="rangeSelect" onchange="toggleFields('filter_f107')">
                            <option value="" disabled selected>Select a Range</option>
                            <option value="between">Between</option>
                            <option value="lesserThan">Lesser Than</option>
                            <option value="greaterThan">Greater Than</option>
                        </select>
                    </div>
                    <div>
                        <label id="minRangeLabel" for="minRange" style="margin-left: 10px;">From</label>
                        <div class="inputContainer">
                            <input type="text" id="minRange" name="minRange" class="between" placeholder="Insert Value" style="display: none;"></input>
                            <span id="minRangeUnit" style="display: none;">SFU</span>
                        </div>
                    </div>
                    <div>
                        <label id="maxRangeLabel" for="maxRange" style="margin-left: 10px;">To</label>
                        <div class="inputContainer">
                            <input type="text" id="maxRange" name="maxRange" class="between" placeholder="Insert Value" style="display: none;">
                            <span id="maxRangeUnit" style="display: none;">SFU</span>
                        </div>
                    </div>
                    <div>
                        <label id="lesserThanLabel" for="lesserThanValue" style="margin-left: 10px;">Lesser Than</label>
                        <div class="inputContainer">
                            <input type="text" id="lesserThanValue" name="lesserThanValue" class="lesserThanInput" placeholder="Insert Value" style="display: none;">
                            <span id="lesserThanUnit" style="display: none;">SFU</span>
                        </div>
                    </div>
                    <div>
                        <label id="greaterThanLabel" for="greaterThanValue" style="margin-left: 10px;">Greater Than</label>
                        <div class="inputContainer">
                            <input type="text" id="greaterThanValue" name="greaterThanValue" class="greaterThanInput" placeholder="Insert Value" style="display: none;">
                            <span id="greaterThanUnit" style="display: none;">SFU</span>
                        </div>
                    </div>
                </div>
                <div id="error_message_range" class="error_message" style="display: none;"></div>
            </div>

            <!-- EFLUX Filter -->
            <div class="filterContainer" id="filter_eflux">
                <div class="filterTitle">EFLUX</div>
                <div class="filterDescription">Net Downgoing Electron Energy Flux</div>
                <div class="filterGrid">
                    <div> 
                        <label id="rangeLabel" for="rangeSelect" style="display:block;">Range</label>
                        <select id="rangeSelect" onchange="toggleFields('filter_eflux')">
                            <option value="" disabled selected>Select a Range</option>
                            <option value="between">Between</option>
                            <option value="lesserThan">Lesser Than</option>
                            <option value="greaterThan">Greater Than</option>
                        </select>
                    </div>
                    <div>
                        <label id="minRangeLabel" for="minRange" style="margin-left: 10px;">From</label>
                        <div class="inputContainer">
                            <input type="text" id="minRange" name="minRange" class="between" placeholder="Insert Value" style="display: none;"></input>
                            <span id="minRangeUnit" style="display: none;">ergs/cm²-s</span>
                        </div>
                    </div>
                    <div>
                        <label id="maxRangeLabel" for="maxRange" style="margin-left: 10px;">To</label>
                        <div class="inputContainer">
                            <input type="text" id="maxRange" name="maxRange" class="between" placeholder="Insert Value" style="display: none;">
                            <span id="maxRangeUnit" style="display: none;">ergs/cm²-s</span>
                        </div>
                    </div>
                    <div>
                        <label id="lesserThanLabel" for="lesserThanValue" style="margin-left: 10px;">Lesser Than</label>
                        <div class="inputContainer">
                            <input type="text" id="lesserThanValue" name="lesserThanValue" class="lesserThanInput" placeholder="Insert Value" style="display: none;">
                            <span id="lesserThanUnit" style="display: none;">ergs/cm²-s</span>
                        </div>
                    </div>
                    <div>
                        <label id="greaterThanLabel" for="greaterThanValue" style="margin-left: 10px;">Greater Than</label>
                        <div class="inputContainer">
                            <input type="text" id="greaterThanValue" name="greaterThanValue" class="greaterThanInput" placeholder="Insert Value" style="display: none;">
                            <span id="greaterThanUnit" style="display: none;">ergs/cm²-s</span>
                        </div>
                    </div>
                </div>
                <div id="error_message_range" class="error_message" style="display: none;"></div>
            </div>

            <!-- NFLUX Filter -->
            <div class="filterContainer" id="filter_nflux">
                <div class="filterTitle">NFLUX</div>
                <div class="filterDescription">Net Downgoing Electron Number Flux</div>
                <div class="filterGrid">
                    <div> 
                        <label id="rangeLabel" for="rangeSelect" style="display:block;">Range</label>
                        <select id="rangeSelect" onchange="toggleFields('filter_nflux')">
                            <option value="" disabled selected>Select a Range</option>
                            <option value="between">Between</option>
                            <option value="lesserThan">Lesser Than</option>
                            <option value="greaterThan">Greater Than</option>
                        </select>
                    </div>
                    <div>
                        <label id="minRangeLabel" for="minRange" style="margin-left: 10px;">From</label>
                        <div class="inputContainer">
                            <input type="text" id="minRange" name="minRange" class="between" placeholder="Insert Value" style="display: none;"></input>
                            <span id="minRangeUnit" style="display: none;">#/cm²-s</span>
                        </div>
                    </div>
                    <div>
                        <label id="maxRangeLabel" for="maxRange" style="margin-left: 10px;">To</label>
                        <div class="inputContainer">
                            <input type="text" id="maxRange" name="maxRange" class="between" placeholder="Insert Value" style="display: none;">
                            <span id="maxRangeUnit" style="display: none;">#/cm²-s</span>
                        </div>
                    </div>
                    <div>
                        <label id="lesserThanLabel" for="lesserThanValue" style="margin-left: 10px;">Lesser Than</label>
                        <div class="inputContainer">
                            <input type="text" id="lesserThanValue" name="lesserThanValue" class="lesserThanInput" placeholder="Insert Value" style="display: none;">
                            <span id="lesserThanUnit" style="display: none;">#/cm²-s</span>
                        </div>
                    </div>
                    <div>
                        <label id="greaterThanLabel" for="greaterThanValue" style="margin-left: 10px;">Greater Than</label>
                        <div class="inputContainer">
                            <input type="text" id="greaterThanValue" name="greaterThanValue" class="greaterThanInput" placeholder="Insert Value" style="display: none;">
                            <span id="greaterThanUnit" style="display: none;">#/cm²-s</span>
                        </div>
                    </div>
                </div>
                <div id="error_message_range" class="error_message" style="display: none;"></div>
            </div>

            <!-- CONJUGATE SZA Filter -->
            <div class="filterContainer" id="filter_conjugate_sza">
                <div class="filterTitle">CONJUGATE SZA</div>
                <div class="filterDescription">Solar Zenith Angle of the Conjugate Foot Point</div>
                <div class="filterGrid">
                    <div> 
                        <label id="rangeLabel" for="rangeSelect" style="display:block;">Range</label>
                        <select id="rangeSelect" onchange="toggleFields('filter_conjugate_sza')">
                            <option value="" disabled selected>Select a Range</option>
                            <option value="between">Between</option>
                            <option value="lesserThan">Lesser Than</option>
                            <option value="greaterThan">Greater Than</option>
                        </select>
                    </div>
                    <div>
                        <label id="minRangeLabel" for="minRange" style="margin-left: 10px;">From</label>
                        <div class="inputContainer">
                            <input type="text" id="minRange" name="minRange" class="between" placeholder="Insert Value" style="display: none;"></input>
                            <span id="minRangeUnit" style="display: none;">Degree(s)</span>
                        </div>
                    </div>
                    <div>
                        <label id="maxRangeLabel" for="maxRange" style="margin-left: 10px;">To</label>
                        <div class="inputContainer">
                            <input type="text" id="maxRange" name="maxRange" class="between" placeholder="Insert Value" style="display: none;">
                            <span id="maxRangeUnit" style="display: none;">Degree(s)</span>
                        </div>
                    </div>
                    <div>
                        <label id="lesserThanLabel" for="lesserThanValue" style="margin-left: 10px;">Lesser Than</label>
                        <div class="inputContainer">
                            <input type="text" id="lesserThanValue" name="lesserThanValue" class="lesserThanInput" placeholder="Insert Value" style="display: none;">
                            <span id="lesserThanUnit" style="display: none;">Degree(s)</span>
                        </div>
                    </div>
                    <div>
                        <label id="greaterThanLabel" for="greaterThanValue" style="margin-left: 10px;">Greater Than</label>
                        <div class="inputContainer">
                            <input type="text" id="greaterThanValue" name="greaterThanValue" class="greaterThanInput" placeholder="Insert Value" style="display: none;">
                            <span id="greaterThanUnit" style="display: none;">Degree(s)</span>
                        </div>
                    </div>
                </div>
                <div id="error_message_range" class="error_message" style="display: none;"></div>
            </div>

            <!-- KP Filter -->
            <div class="filterContainer" id="filter_kp">
                <div class="filterTitle">KP</div>
                <div class="filterDescription">KP Geomagnetic index (+= 0.33 and -= 0.67)</div>
                <div class="filterGrid">
                    <div> 
                        <label id="rangeLabel" for="rangeSelect" style="display:block;">Range</label>
                        <select id="rangeSelect" onchange="toggleFields('filter_kp')">
                            <option value="" disabled selected>Select a Range</option>
                            <option value="between">Between</option>
                            <option value="lesserThan">Lesser Than</option>
                            <option value="greaterThan">Greater Than</option>
                        </select>
                    </div>
                    <div>
                        <label id="minRangeLabel" for="minRange" style="margin-left: 10px;">From</label>
                        <div class="inputContainer">
                            <input type="text" id="minRange" name="minRange" class="between" placeholder="Insert Value" style="display: none;"></input>
                            <span id="minRangeUnit" style="display: none;"></span>
                        </div>
                    </div>
                    <div>
                        <label id="maxRangeLabel" for="maxRange" style="margin-left: 10px;">To</label>
                        <div class="inputContainer">
                            <input type="text" id="maxRange" name="maxRange" class="between" placeholder="Insert Value" style="display: none;">
                            <span id="maxRangeUnit" style="display: none;"></span>
                        </div>
                    </div>
                    <div>
                        <label id="lesserThanLabel" for="lesserThanValue" style="margin-left: 10px;">Lesser Than</label>
                        <div class="inputContainer">
                            <input type="text" id="lesserThanValue" name="lesserThanValue" class="lesserThanInput" placeholder="Insert Value" style="display: none;">
                            <span id="lesserThanUnit" style="display: none;"></span>
                        </div>
                    </div>
                    <div>
                        <label id="greaterThanLabel" for="greaterThanValue" style="margin-left: 10px;">Greater Than</label>
                        <div class="inputContainer">
                            <input type="text" id="greaterThanValue" name="greaterThanValue" class="greaterThanInput" placeholder="Insert Value" style="display: none;">
                            <span id="greaterThanUnit" style="display: none;"></span>
                        </div>
                    </div>
                </div>
                <div id="error_message_range" class="error_message" style="display: none;"></div>
            </div>

            <!-- AE Filter -->
            <div class="filterContainer" id="filter_ae">
                <div class="filterTitle">AE</div>
                <div class="filterDescription">AE Geomagnetic Index</div>
                <div class="filterGrid">
                    <div> 
                        <label id="rangeLabel" for="rangeSelect" style="display:block;">Range</label>
                        <select id="rangeSelect" onchange="toggleFields('filter_ae')">
                            <option value="" disabled selected>Select a Range</option>
                            <option value="between">Between</option>
                            <option value="lesserThan">Lesser Than</option>
                            <option value="greaterThan">Greater Than</option>
                        </select>
                    </div>
                    <div>
                        <label id="minRangeLabel" for="minRange" style="margin-left: 10px;">From</label>
                        <div class="inputContainer">
                            <input type="text" id="minRange" name="minRange" class="between" placeholder="Insert Value" style="display: none; width: 130px; padding-right: 100px;"></input>
                            <span id="minRangeUnit" style="display: none;">nano Tesla (nT)</span>
                        </div>
                    </div>
                    <div>
                        <label id="maxRangeLabel" for="maxRange" style="margin-left: 10px;">To</label>
                        <div class="inputContainer">
                            <input type="text" id="maxRange" name="maxRange" class="between" placeholder="Insert Value" style="display: none; width: 130px; padding-right: 100px;">
                            <span id="maxRangeUnit" style="display: none;">nano Tesla (nT)</span>
                        </div>
                    </div>
                    <div>
                        <label id="lesserThanLabel" for="lesserThanValue" style="margin-left: 10px;">Lesser Than</label>
                        <div class="inputContainer">
                            <input type="text" id="lesserThanValue" name="lesserThanValue" class="lesserThanInput" placeholder="Insert Value" style="display: none; width: 130px; padding-right: 100px;">
                            <span id="lesserThanUnit" style="display: none;">nano Tesla (nT)</span>
                        </div>
                    </div>
                    <div>
                        <label id="greaterThanLabel" for="greaterThanValue" style="margin-left: 10px;">Greater Than</label>
                        <div class="inputContainer">
                            <input type="text" id="greaterThanValue" name="greaterThanValue" class="greaterThanInput" placeholder="Insert Value" style="display: none; width: 130px; padding-right: 100px;">
                            <span id="greaterThanUnit" style="display: none;">nano Tesla (nT)</span>
                        </div>
                    </div>
                </div>
                <div id="error_message_range" class="error_message" style="display: none;"></div>
            </div>

            <!-- DST Filter -->
            <div class="filterContainer" id="filter_dst">
                <div class="filterTitle">DST</div>
                <div class="filterDescription">DST Geomagnetic Index</div>
                <div class="filterGrid">
                    <div> 
                        <label id="rangeLabel" for="rangeSelect" style="display:block;">Range</label>
                        <select id="rangeSelect" onchange="toggleFields('filter_dst')">
                            <option value="" disabled selected>Select a Range</option>
                            <option value="between">Between</option>
                            <option value="lesserThan">Lesser Than</option>
                            <option value="greaterThan">Greater Than</option>
                        </select>
                    </div>
                    <div>
                        <label id="minRangeLabel" for="minRange" style="margin-left: 10px;">From</label>
                        <div class="inputContainer">
                            <input type="text" id="minRange" name="minRange" class="between" placeholder="Insert Value" style="display: none; width: 130px; padding-right: 100px;"></input>
                            <span id="minRangeUnit" style="display: none;">nano Tesla (nT)</span>
                        </div>
                    </div>
                    <div>
                        <label id="maxRangeLabel" for="maxRange" style="margin-left: 10px;">To</label>
                        <div class="inputContainer">
                            <input type="text" id="maxRange" name="maxRange" class="between" placeholder="Insert Value" style="display: none; width: 130px; padding-right: 100px;">
                            <span id="maxRangeUnit" style="display: none;">nano Tesla (nT)</span>
                        </div>
                    </div>
                    <div>
                        <label id="lesserThanLabel" for="lesserThanValue" style="margin-left: 10px;">Lesser Than</label>
                        <div class="inputContainer">
                            <input type="text" id="lesserThanValue" name="lesserThanValue" class="lesserThanInput" placeholder="Insert Value" style="display: none; width: 130px; padding-right: 100px;">
                            <span id="lesserThanUnit" style="display: none;">nano Tesla (nT)</span>
                        </div>
                    </div>
                    <div>
                        <label id="greaterThanLabel" for="greaterThanValue" style="margin-left: 10px;">Greater Than</label>
                        <div class="inputContainer">
                            <input type="text" id="greaterThanValue" name="greaterThanValue" class="greaterThanInput" placeholder="Insert Value" style="display: none; width: 130px; padding-right: 100px;">
                            <span id="greaterThanUnit" style="display: none;">nano Tesla (nT)</span>
                        </div>
                    </div>
                </div>
                <div id="error_message_range" class="error_message" style="display: none;"></div>
            </div>

            <!-- NEWELL FLUX Filter -->
            <div class="filterContainer" id="filter_newell_flux">
                <div class="filterTitle">SOLAR WIND DRIVING</div>
                <div class="filterDescription">Dayside Merging Rate <br/> Mean = 4415.95, Median = 3157.64 </div>
                <div class="filterGrid">
                    <div> 
                        <label id="rangeLabel" for="rangeSelect" style="display:block;">Range</label>
                        <select id="rangeSelect" onchange="toggleFields('filter_newell_flux')">
                            <option value="" disabled selected>Select a Range</option>
                            <option value="between">Between</option>
                            <option value="lesserThan">Lesser Than</option>
                            <option value="greaterThan">Greater Than</option>
                        </select>
                    </div>
                    <div>
                        <label id="minRangeLabel" for="minRange" style="margin-left: 10px;">From</label>
                        <div class="inputContainer">
                            <input type="text" id="minRange" name="minRange" class="between" placeholder="Insert Value" style="display: none; width: 100px; padding-right: 130px;"></input>
                            <span id="minRangeUnit" style="display: none;">((km/s)<sup>4/3</sup>) x (nT<sup>2/3</sup>)</span>
                        </div>
                    </div>
                    <div>
                        <label id="maxRangeLabel" for="maxRange" style="margin-left: 10px;">To</label>
                        <div class="inputContainer">
                            <input type="text" id="maxRange" name="maxRange" class="between" placeholder="Insert Value" style="display: none; width: 100px; padding-right: 130px;">
                            <span id="maxRangeUnit" style="display: none;">((km/s)<sup>4/3</sup>) x (nT<sup>2/3</sup>)</span>
                        </div>
                    </div>
                    <div>
                        <label id="lesserThanLabel" for="lesserThanValue" style="margin-left: 10px;">Lesser Than</label>
                        <div class="inputContainer">
                            <input type="text" id="lesserThanValue" name="lesserThanValue" class="lesserThanInput" placeholder="Insert Value" style="display: none; width: 100px; padding-right: 130px;">
                            <span id="lesserThanUnit" style="display: none;">((km/s)<sup>4/3</sup>) x (nT<sup>2/3</sup>)</span>
                        </div>
                    </div>
                    <div>
                        <label id="greaterThanLabel" for="greaterThanValue" style="margin-left: 10px;">Greater Than</label>
                        <div class="inputContainer">
                            <input type="text" id="greaterThanValue" name="greaterThanValue" class="greaterThanInput" placeholder="Insert Value" style="display: none; width: 100px; padding-right: 130px;">
                            <span id="greaterThanUnit" style="display: none;">((km/s)<sup>4/3</sup>) x (nT<sup>2/3</sup>)</span>
                        </div>
                    </div>
                </div>
                <div id="error_message_range" class="error_message" style="display: none;"></div>
            </div>

            <!-- LOST CONE ANGLE (LCA) Filter -->
            <div class="filterContainer" id="filter_lca">
                <div class="filterTitle">LCA</div>
                <div class="filterDescription">Theoretical Lost Cone Angle at Measurement Location as per IGRF Model</div>
                <div class="filterGrid">
                    <div> 
                        <label id="rangeLabel" for="rangeSelect" style="display:block;">Range</label>
                        <select id="rangeSelect" onchange="toggleFields('filter_lca')">
                            <option value="" disabled selected>Select a Range</option>
                            <option value="between">Between</option>
                            <option value="lesserThan">Lesser Than</option>
                            <option value="greaterThan">Greater Than</option>
                        </select>
                    </div>
                    <div>
                        <label id="minRangeLabel" for="minRange" style="margin-left: 10px;">From</label>
                        <div class="inputContainer">
                            <input type="text" id="minRange" name="minRange" class="between" placeholder="Insert Value" style="display: none;"></input>
                            <span id="minRangeUnit" style="display: none;">Degree(s)</span>
                        </div>
                    </div>
                    <div>
                        <label id="maxRangeLabel" for="maxRange" style="margin-left: 10px;">To</label>
                        <div class="inputContainer">
                            <input type="text" id="maxRange" name="maxRange" class="between" placeholder="Insert Value" style="display: none;">
                            <span id="maxRangeUnit" style="display: none;">Degree(s)</span>
                        </div>
                    </div>
                    <div>
                        <label id="lesserThanLabel" for="lesserThanValue" style="margin-left: 10px;">Lesser Than</label>
                        <div class="inputContainer">
                            <input type="text" id="lesserThanValue" name="lesserThanValue" class="lesserThanInput" placeholder="Insert Value" style="display: none;">
                            <span id="lesserThanUnit" style="display: none;">Degree(s)</span>
                        </div>
                    </div>
                    <div>
                        <label id="greaterThanLabel" for="greaterThanValue" style="margin-left: 10px;">Greater Than</label>
                        <div class="inputContainer">
                            <input type="text" id="greaterThanValue" name="greaterThanValue" class="greaterThanInput" placeholder="Insert Value" style="display: none;">
                            <span id="greaterThanUnit" style="display: none;">Degree(s)</span>
                        </div>
                    </div>
                </div>
                <div id="error_message_range" class="error_message" style="display: none;"></div>
            </div>
            
            <!-- MECH Filter  -->
            <div class="filterContainer" id="filter_mechs">
                <div class="filterTitle">MECHANISMS</div>
                <div class="filterDescription">QS: Quasi-Static <br/> Alf: Aflv&#233nic <br/> WS: Wave-Scattering</div>
                <div class="filterGrid">
                    <div>
                        <label class="spectraRequirementsContainer">QS Only 
                            <input type="radio" name="mechs">
                            <span class="checkmark"></span>
                        </label>
                        <label class="spectraRequirementsContainer">QS Dominant 
                            <input type="radio" name="mechs">
                            <span class="checkmark"></span>
                        </label>
                        <label class="spectraRequirementsContainer">Alf Only 
                            <input type="radio" name="mechs">
                            <span class="checkmark"></span>
                        </label>
                        <label class="spectraRequirementsContainer">Alf Dominant
                            <input type="radio" name="mechs">
                            <span class="checkmark"></span>
                        </label>
                        <label class="spectraRequirementsContainer">WS Only 
                            <input type="radio" name="mechs">
                            <span class="checkmark"></span>
                        </label>
                        <label class="spectraRequirementsContainer">WS Dominant
                            <input type="radio" name="mechs">
                            <span class="checkmark"></span>
                        </label>
                        <label class="spectraRequirementsContainer">QS + Alf
                            <input type="radio" name="mechs">
                            <span class="checkmark"></span>
                        </label>
                        <label class="spectraRequirementsContainer">QS + WS
                            <input type="radio" name="mechs">
                            <span class="checkmark"></span>
                        </label>
                    </div>
                    <div> 
                        <label class="spectraRequirementsContainer">Alf + WS
                            <input type="radio" name="mechs">
                            <span class="checkmark"></span>
                        </label>
                        <label class="spectraRequirementsContainer">Alf + WS + QS
                            <input type="radio" name="mechs">
                            <span class="checkmark"></span>
                        </label>
                        <label class="spectraRequirementsContainer">Any QS
                            <input type="radio" name="mechs">
                            <span class="checkmark"></span>
                        </label>
                        <label class="spectraRequirementsContainer">Any Alf 
                            <input type="radio" name="mechs">
                            <span class="checkmark"></span>
                        </label>
                        <label class="spectraRequirementsContainer">Any Wave Scattering  
                            <input type="radio" name="mechs">
                            <span class="checkmark"></span>
                        </label>
                        <label class="spectraRequirementsContainer">Weak 
                            <input type="radio" name="mechs">
                            <span class="checkmark"></span>
                        </label>
                        <label class="spectraRequirementsContainer">Any Intense
                            <input type="radio" name="mechs">
                            <span class="checkmark"></span>
                        </label>
                    </div>  
                </div>
                <div id="error_message_range" class="error_message" style="display: none;"></div>
            </div>
        </div>


        <!-- Early Mission/ Late Mission -->
        <p style="margin-left: -540px; margin-bottom: -20px; margin-top: 60px; font-weight: 900;">STEP 3: Check for Early Mission / Late Mission</p>
        <div class="missionFrame">

            <button id="generateMissionButton" class="generateMissionButton" onclick="generateMissionCount()">Check Early / Late Mission</button>

            <div class="missionInfo">
                <h3 style=>Early Mission</h3>
                <div style="display: flex; flex-wrap: wrap;">
                    <div id="earlyMissionRowData" class="missionRowData">--</div>
                </div>
            </div>

            <div class="missionInfo">
                <h3>Late Mission</h3>
                <div style="display: flex; flex-wrap: wrap;">
                    <div id="lateMissionRowData" class="missionRowData">--</div>
                </div>
            </div>
        </div>

        
        <!-- Spectra Generation Requirements -->
        <p style="margin-left: -580px; margin-bottom: -20px; margin-top: 60px; font-weight: 900;">STEP 4: Spectra Generation Requirements</p>
        <div class ="spectraGenerationRequirementContainer">

            <!-- Statistics -->
            <div class="spectraGenerationRequirementCategory" id="Statistics">
                <div class = "filterTitle">Statistics</div>
                <label class="spectraRequirementsContainer" style="margin-top:10px;">Mean
                    <input type="checkbox" checked="checked">
                    <span class="checkmark"></span>
                </label>
                <label class="spectraRequirementsContainer" style="margin-top:10px;">+1σ
                    <input type="checkbox" checked="checked">
                    <span class="checkmark"></span>
                </label>
                <label class="spectraRequirementsContainer" style="margin-top:10px;">-1σ
                    <input type="checkbox" checked="checked">
                    <span class="checkmark"></span>
                </label>
                <label class="spectraRequirementsContainer" style="margin-top:10px;">Median 
                    <input type="checkbox" checked="checked">
                    <span class="checkmark"></span>
                </label>
                <label class="spectraRequirementsContainer" style="margin-top:10px;">25% 
                    <input type="checkbox" checked="checked">
                    <span class="checkmark"></span>
                </label>
                <label class="spectraRequirementsContainer" style="margin-top:10px;">75% 
                    <input type="checkbox" checked="checked">
                    <span class="checkmark"></span>
                </label>
            </div>

            <!-- Spectra -->
            <div class="spectraGenerationRequirementCategory" id="Spectra">
                <div class = "filterTitle">Spectra</div>
                <label class="spectraRequirementsContainer" style="margin-top:10px;">Downward
                    <input type="radio" name="spectra" checked="checked">
                    <span class="checkmark"></span>
                </label>
                <label class="spectraRequirementsContainer" style="margin-top:10px;">Upward 
                    <input type="radio" name="spectra">
                    <span class="checkmark"></span>
                </label>
                <label class="spectraRequirementsContainer" style="margin-top:10px;">Mirroring 
                    <input type="radio" name="spectra">
                    <span class="checkmark"></span>
                </label>
            </div>

            <!-- Normalization  -->
            <div class="spectraGenerationRequirementCategory" id="Normalization">
                <div class = "filterTitle">Normalization</div>
                <label class="spectraRequirementsContainer" style="margin-top:10px;">Raw
                    <input type="radio" checked="checked" name="normalization">
                    <span class="checkmark"></span>
                </label>
                <label class="spectraRequirementsContainer" style="margin-top:10px;">Energy Flux 
                    <input type="radio" name="normalization">
                    <span class="checkmark"></span>
                </label>
                <label class="spectraRequirementsContainer" style="margin-top:10px;">Number Flux  
                    <input type="radio" name="normalization">
                    <span class="checkmark"></span>
                </label>
            </div>

            <!-- Mission -->
            <div class="spectraGenerationRequirementCategory" id="Mission">
                <div class = "filterTitle">Mission</div>
                <label class="spectraRequirementsContainer" style="margin-top:10px;">Early Mission  
                    <input type="radio" checked="checked" name="mission">
                    <span class="checkmark"></span>
                </label>
                <label class="spectraRequirementsContainer" style="margin-top:10px;">Late Mission
                    <input type="radio" name="mission">
                    <span class="checkmark"></span>
                </label>
                <label class="spectraRequirementsContainer" style="margin-top:10px;"  onchange="alert('Warning: Energy Values may not be scientifically accurate when combining Both Early and Late Mission Together')">Both 
                    <input type="radio" name="mission">
                    <span class="checkmark"></span>
                </label>
            </div>
        </div>

        <br/>

        <p id="noFilterSelectedError" style="color: rgb(222,82,82,1); font-weight: 900; display: none;">No Filters Selected</p>

        <!-- Clear Filters and Generate Spectra Buttons -->
        <div class="spectraControlContainer">
            <button id="clearFilters" class="clearFiltersButton" onclick="clearAllFilters()">Clear Filters</button>
            <button id="generateSpectra" class="generateSpectraButton" onclick="generateSpectra()">Generate Spectra</button>
        </div>
        
        <!-- Spectra Panel -->
        <div id="spectraPanel" class="modal">
            <div class="spectraPanelContiner">
                <span class="close" onclick="closeModal()">&times;</span>
                <h2>Statistical Electron Spectra Graph Generation</h2>

                <!-- <div id="modalContent" class="modalContent"></div> -->

                <!-- Selection Criteria Displayed here -->
                <p style="font-weight: 900;">Selection Criteria</p>
                <div id="selectionCriteriaContainter" class="selectionCriteriaContainter"></div><br/><br/>

                <!-- Graph Generated here -->
                <p style="font-weight: 900;">Spectra Analysis</p>
                <div class="chartsContainer">
                    <canvas id="myChart" style="width:80%; height: 50%;"></canvas>  
                </div><br/>

                <!-- Export to CSV Button -->
                <div class="modalControlContainer"> 
                    <button id="exportCSV" class="exportCSVButton" onclick="exportCSV()">Download Datasets</button>
                    <button id="exportJPEG" class="exportJPEGButton" onclick="exportJPEG()">Download Graph</button>
                </div>
        </div>

        <script>
            // Function to create chart when user clicks on generateSpectra button 
            function createCharts() {

                // Get the canvas element
                var canvas = document.getElementById('myChart');
                var ctx = canvas.getContext('2d');

                // Check if there's an existing chart instance
                let chartStatus = Chart.getChart("myChart");
                if (chartStatus != undefined) {
                    chartStatus.destroy();
                }
                
                // Early Mission
                var mission = inputDict["Mission"][0];
                var xValues = (mission === "Early Mission") ? earlyMission_xValues :
                              (mission === "Late Mission") ? lateMission_xValues :
                              bothMissions_xValues;

                var yValues = [];
                var allYValues = []; 

                // Gradient Colors
                // Red (-sigma)
                const minusSigmaColor = "rgba(250,121,112,0.6)";
                const minusSigmaGradient = ctx.createLinearGradient(0, 0, 0, 500);
                minusSigmaGradient.addColorStop(0, 'rgba(250, 121, 112, 0.15)');
                minusSigmaGradient.addColorStop(1, 'rgba(250, 121, 112, 0)');

                // Orange (75 percentile)
                const percentile75Color = "rgba(250,163,86,0.6)";
                const percentile75Gradient = ctx.createLinearGradient(0, 0, 0, 500);
                percentile75Gradient.addColorStop(0, 'rgba(250, 163, 86, 0.15)');
                percentile75Gradient.addColorStop(1, 'rgba(250, 163, 86, 0)');

                // Green (25 percentile)
                const percentile25Color = "rgba(124,227,139,0.6)";
                const percentile25Gradient = ctx.createLinearGradient(0, 0, 0, 500);
                percentile25Gradient.addColorStop(0, 'rgba(124,227,139, 0.15)');
                percentile25Gradient.addColorStop(1, 'rgba(124,227,139, 0)');

                // Cyan (+ sigma)
                const plusSigmaColor = "rgba(3,218,198,0.6)";
                const plusSigmaGradient = ctx.createLinearGradient(0, 0, 0, 500);
                plusSigmaGradient.addColorStop(0, 'rgba(3, 218, 198, 0.15)');
                plusSigmaGradient.addColorStop(1, 'rgba(3, 218, 198, 0)');

                // Blue (Median)
                const medianColor = "rgba(119,189,251,0.6)";
                const medianGradient = ctx.createLinearGradient(0, 0, 0, 500);
                medianGradient.addColorStop(0, 'rgba(119,189,251, 0.15)');
                medianGradient.addColorStop(1, 'rgba(119,189,251, 0)');

                // Purple (Mean)
                const meanColor = "rgba(206,165,251,0.6)";
                const meanGradient = ctx.createLinearGradient(0, 0, 0, 500);
                meanGradient.addColorStop(0, 'rgba(206,165,251, 0.15)');
                meanGradient.addColorStop(1, 'rgba(206,165,251, 0)');

                // Define a lookup table for common properties (Without Gradient)
                // const propertiesLookup = {
                //     "Mean": { borderColor: "rgba(250,121,112,0.5)", backgroundColor: "rgba(250,121,112,1.0)", borderDash: [0,0], yAxisID: 'statistics' },
                //     "Median": { borderColor: "rgba(250,163,86,0.5)", backgroundColor: "rgba(250,163,86,1.0)", borderDash: [10,10], yAxisID: 'statistics' },
                //     "+1\u03c3": { borderColor: "rgba(124,227,139,0.5)", backgroundColor: "rgba(124,227,139,1.0)", borderDash: [2,2], yAxisID: 'statistics' },
                //     "-1\u03c3": { borderColor: "rgba(3,218,198,0.5)", backgroundColor: "rgba(3,218,198,1.0)", borderDash: [0,0], yAxisID: 'statistics' },
                //     "25%": { borderColor: "rgba(119,189,251,0.5)", backgroundColor: "rgba(119,189,251,1.0)", borderDash: [10,10], yAxisID: 'statistics' },
                //     "75%": { borderColor: "rgba(206,165,251,0.5)", backgroundColor: "rgba(206,165,251,1.0)", borderDash: [2,2], yAxisID: 'statistics' }
                // };

                // Define a lookup table for common properties (With Gradient)
                const propertiesLookup = {
                    "Mean": { borderColor: meanColor, backgroundColor: meanGradient, borderDash: [0,0], yAxisID: 'statistics' },
                    "Median": { borderColor: medianColor, backgroundColor: medianGradient, borderDash: [10,10], yAxisID: 'statistics' },
                    "+1\u03c3": { borderColor: plusSigmaColor, backgroundColor: plusSigmaGradient, borderDash: [2,2], yAxisID: 'statistics' },
                    "-1\u03c3": { borderColor: minusSigmaColor, backgroundColor: minusSigmaGradient, borderDash: [0,0], yAxisID: 'statistics' },
                    "25%": { borderColor: percentile25Color, backgroundColor: percentile25Gradient, borderDash: [10,10], yAxisID: 'statistics' },
                    "75%": { borderColor: percentile75Color, backgroundColor: percentile75Gradient, borderDash: [2,2], yAxisID: 'statistics' }
                };

                // Iterate over each statistic (e.g., "Mean", "Median", etc.)
                for (var statKey in resultData.result.yAxis) {
                    if (resultData.result.yAxis.hasOwnProperty(statKey) && propertiesLookup.hasOwnProperty(statKey)) {
                        // Get the statistics object for the current key
                        var statData = resultData.result.yAxis[statKey];

                        // Concatenate all y-axis values
                        allYValues = allYValues.concat(statData); 

                        // Create a dataset object using common properties
                        var dataset = { label: statKey, data: statData, ...propertiesLookup[statKey],
                                        fill: true};

                        // Push the dataset object into the datasets array
                        yValues.push(dataset);
                    }
                }

                // Determine the min and max values for both x and y axes 
                var minY = Math.min(...allYValues);
                var maxY = Math.max(...allYValues);

                // Create a dynamic scales object for both x and y axes
                var scales = {
                    statistics: {
                        title: {
                            display: true,
                            font: {
                                size: 16
                            },
                            text: 'dEFlux',
                            color: 'white'
                        },
                        grid: {
                            display: true,
                            drawTicks: true,
                            lineWidth: 0.5, 
                            tickColor: 'rgb(255, 255, 255, 0.8)',
                            color: 'rgb(255, 255, 255, 0.4)'
                        },
                        ticks: {
                            color: "rgb(255,255,255,0.7)",
                            font : {
                                size: 13
                            }
                        }
                    },
                    x: {
                        type: 'logarithmic',
                        display: true,
                        ticks: {
                            maxTickLimit: 6,
                            autoSkip: true, 
                            min: Math.pow(10, Math.floor(Math.log10(Math.min(...xValues)))),
                            max: Math.pow(10, Math.ceil(Math.log10(Math.max(...xValues)))),
                            callback: function(value, index, values) {
                                var labels = [0, 10, 100, 1000, 10000];
                                var max = Math.max(...values);
                                if (value === max) {
                                    return ''; 
                                }
                                var formattedValue = labels.find(label => value <= label);
                                if (formattedValue !== undefined && value === formattedValue) {
                                    return formattedValue;
                                } else {
                                    return ''; 
                                }
                            },
                            color: "rgb(255,255,255,0.7)",
                            font : {
                                size: 13
                            }
                        },
                        title: {
                            display: true,
                            font: {
                                size: 16
                            },
                            text: 'Energy (eV)',
                            color: 'white'
                        },
                        grid: {
                            display: true,
                            drawTicks: true,
                            lineWidth: 0.5, 
                            tickColor: 'rgb(255, 255, 255, 1)',
                            color: 'rgb(255, 255, 255, 0.4)'
                        }
                    }
                };

                // Draw Border
                const chartAreaBorder = {
                    id: 'chartAreaBorder',
                    beforeDraw(chart, args, options) {
                        const { ctx, chartArea: { left, top, width, height } } = chart;
                        ctx.save();
                        ctx.strokeStyle = options.borderColor;
                        ctx.lineWidth = options.borderWidth;
                        ctx.setLineDash(options.borderDash || []);
                        ctx.lineDashOffset = options.borderDashOffset;
                        ctx.strokeRect(left, top, width, height);
                        ctx.restore();
                    }
                };

                let delayed = false;

                // Create a new chart Instance
                var myChart = new Chart(ctx, {
                    type: 'line',
                    data: { labels: xValues, datasets: yValues },
                    options: {
                        animation: {
                            // onComplete: () => {
                            //     console.log("Animation complete");
                            //     delayed = true;
                            // },
                            // delay: (context) => {
                            //     let delay = 0;
                            //     if (context.type === 'data' && context.mode === 'default' && !delayed) {
                            //         delay = context.dataIndex * 300 + context.datasetIndex * 100;
                            //     }
                            //     console.log("Delay: ", delay);
                            //     return delay;
                            // },
                            easing: "easeInOutBack"
                        },
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            chartAreaBorder: {
                                borderColor: 'rgb(255,255,255,0.7)',
                                borderWidth: 1
                            },
                            legend: {
                                labels : {
                                    color: 'rgb(255,255,255,1)',
                                    font: {
                                        size: 15 
                                    }
                                }
                            }
                        },
                        scales: scales,
                        maintainAspectRatio: false,
                    },
                    plugins: [chartAreaBorder]
                });
            }
        </script>
    </body>
</html>
